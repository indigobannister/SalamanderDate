---
title: "Analysis of Pacific Giant Salamander Abundance and Weight Under Forest Management"
author: "Indigo Bannister & Gavriella Keyles"
date: "December 4, 2019"
output: 
  html_document:
    css: bootstrap.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
```

```{r}
# Attach Packages

# In order to install extrafont, use following code in the console:
## install.packages("extrafont")

# In order to install NPS colors, use following code in the console:
## install.packages("devtools")
## devtools::install_github("katiejolly/nationalparkcolors")

# Attach packages
library(tidyverse)
library(tidyr)
library(here)
library(janitor)
library(ggridges)
library(plotly)
library(extrafont)
library(nationalparkcolors)
library(kableExtra)
library(effsize)
library(car)
library(ggbeeswarm)

# Load fonts
loadfonts()
```

```{r}
# Read in data and create new tidy dataframe, filtered to DITE as species
salamander_raw <- read_csv(here("raw_data", "mack_creek_vertebrates.csv")) 

salamander_clean <- salamander_raw %>% 
  clean_names() %>%
  filter(species == "DITE") %>% 
  select(section, weight, year, unittype)
  
```

\


<center>
![](images/pacific_salamander.jpg){ width=75% }
</center>
<font size="2"> ***Figure 1:*** *Pacific Giant Salamander (Dicamptodon tenebrosus), in Opal Creek Wilderness, Oregon. Photographer: [Dave Huth</font>](https://www.flickr.com/photos/davemedia/9094499321).*

\

### Introduction
Pacific giant salamanders (*Dicamptodon tenebrosus*), the largest terrestrial salamander in North America, thrive in the wet forests of coastal northern California, Oregon, and Washington (California Herps, 2019). Their preferred habitat is near clear, cold streams, rivers, lakes, or ponds with rocks, logs or root channels to burrow under. Larvae hatch under water and spend approximately the first two years of their lives in the water. Once they transform to their terrestrial forms, reproduction also occurs in the water, (California Herps, 2019). Due to their sensitivity to water quality, Pacific giant salamanders are used as an indicator species of the declining health of waterways. Logging can be particularly impactful on Pacific giant salamanders due to the increased sedimentation of streams from erosion (Oregon Wild, 2019). 

Oregon State University has been monitoring the species along Mack Creek in the H.J. Andrews Experimental Forest near Eugene, Oregon since 1993. Electrofishing is used to capture vertebrates along the creek and all captured vertebrates are measured and weighed (Gregory S. V., 2016). The Mack Creek watershed (1,433 acres) contains two unique management histories: approximately 13% of the watershed was clear cut around 1963 and the rest contains a 500-year-old coniferous forest (Andrews Experimental Forest, 2017). This research forest offers a unique chance to consider the long-term impacts of logging on salamander well-being compared to a more natural forest. 

In this analysis, we use data provided by the Andrews Experimental Forest to explore differences in salamander abundance and weight among old growth and clear-cut sections of Mack Creek and among different stream characteristics (pool, cascade, side channel).


\

### Data & methods
<center>
![](images/watershed_map_labelled.jpg){ width=75% }

</center>
<font size="2"> ***Figure 2:*** *Map of HJ Andrews Forest Experimental Watersheds - Mack Creek watershed highlighted in green. Source: [HJ Andrews Experimental Forest</font>](https://andrewsforest.oregonstate.edu/research/infrastructure/watersheds).*


\

Data for populations of Pacific giant salamanders *(Dicamptodon tenebrosus)* were collected in the [H.J. Andrews Experimental Forest](https://andrewsforest.oregonstate.edu/) near Blue River, Oregon as part of the National Science Foundation's Long Term Ecological Research Network. Salamanders were sampled with two-pass electrofishing in two sections of Mack Creek, one reach in a section of clearcut forest (ca. 1963) and the other an upstream 500-year-old coniferous forest. The two sections are then subdivided to indicate where in the channel salamanders were found (pool, cascade, or side-channel). According to project metadata, the purpose of the Aquatic Vertebrate Population Study in Mack Creek, is "to provide a long-term record of populations in aquatic vertebrates...related to land use and disturbance histories."

For more information see the project [metadata](https://portal.lternet.edu/nis/metadataviewer?packageid=knb-lter-and.4027.12)

All analyses and figures were prepared using R software version 3.6.1.

<p style="color:red"> **ADD SUMMARY OF WHAT ANALYSIS WAS CONDUCTED -  types of statistical tests performed, significance level used**</p>

\

### Results

#### 1. Salamander abundance in old-growth and clear-cut sections of Mack Creek
Figure 3 demonstrates that lobster abundance has followed relatively similar trends in Mack Creek depite the different forest management techniques. From 1995 to 2011, salamander counts along the clear-cut sections of Mack Creek were lower than those in the old-growth sections. In the years preceding and following this range, there were years where counts in the clear-cut sections exceeded those in the old-growth sections. Overall trends in abundance seem to impact salamanders no matter what forest type they are in, with both groups experiencing increading and decreasing numbers in the same years.  

```{r,fig.align="center",out.width="100%"}

# Summarize count of salamanders by seciton and year
salamander_count_sec <- salamander_clean %>% 
  group_by(section, year) %>% 
  summarize(count = n()) %>%
  mutate(section_name = 
           ifelse(section == "CC", "Clear-cut",
         ifelse(section == "OG", "Old-growth", "")))

# Create a custom palette for colors in graph_a
site_colors <- park_palette("MtRainier")

# Create plot of salamander count over years at each section
graph_1 <- ggplot(data = salamander_count_sec, 
                  aes(x = year, 
                      y = count,
                      color = section_name)) +
  geom_line(aes(text = paste('Type:', section_name,
                             '<br>Total:', count),
                group = 1)) +
  theme_minimal() +
  scale_color_manual(values = site_colors, name = "Forest Type") +
  labs(x = "Year",
       y = "Number of Salamanders Observed",
       color = "Foreset Type") +
  scale_x_continuous(expand = c(0, 0),
                     limits = c(1993, 2017),
                     breaks = seq(1995, 2015, by = 5)) +
  scale_y_continuous(limits = c(0, 400),
                     breaks = seq(0, 400, by = 50),
                     expand = c(0, 0))
  
# Make graph_a interactive with ggplotly 
ggplotly(graph_1, tooltip = "text") %>% 
  layout(legend = list(x = 0.05, y = 0.85)) %>%
  config(displayModeBar = FALSE)

```
<font size="2"> ***Figure 3: Salamander abundance in clear-cut and old-growth forest, 1993 to 2017.*** *Annual salamander counts through electro-fishing in Mack Creek in the HJ Andrews Experimental Forest.* ***Interactive:*** *Double-click on individual site within legend to highlight. Single-click and unclick sites within legend to toggle visibility and compare site data.*</font>


\

#### 2. Salamander counts by channel classification, 2017
<font size="2"> ***Table 1:***
*2017 counts of Salamanders found in Mack Creek, grouped by section (clear cut vs. old growth) and position within channel (pool, cascades, side-channel).* </font>

```{r}

# Summarize salamander counts by channel classification in 2017

salamander_summary_2017 <- salamander_clean %>% 
  filter(year == "2017", unittype != "IP") %>% 
  mutate(section_name = 
           ifelse(section == "CC", "Clear Cut",
         ifelse(section == "OG", "Old Growth", ""))) %>% 
  group_by(section_name, unittype) %>% 
  summarize(count = n()) %>%
  pivot_wider(names_from = unittype, values_from = count)
  
# Create contingency table

salamander_sum_2017_table <- salamander_summary_2017 %>% 
  janitor::adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front") %>% 
  rename(Section = section_name) %>% 
  rename(Cascades = "C") %>% 
  rename(Pool = "P") %>% 
  rename("Side channel" = "SC")
  
# Make table pretty

kable(salamander_sum_2017_table) %>%
 kable_styling(bootstrap_options = c("striped", "hover"), 
              full_width = F,
              position = "center"
              )

  

```
\

#### 3. Association between forest section and channel classification, 2017

```{r, include = FALSE}

# Run chi sq test to explore whether channel position is independent of section type
chi_sq_table <- salamander_summary_2017[-1]

chi_sq_test <- chisq.test(chi_sq_table)
chi_sq_test
```

We used a Chi-square test to examine the relationship between channel position (pool, side-channel or cascades) and section (clear cut or old growth) in Mack Creek. We found a *X*^2^ value of `r round(chi_sq_test$statistic, 2)` (d.f. `r chi_sq_test$parameter`) with a p-value of `r round(chi_sq_test$p.value, 3)`. As a result, we retain the null hypothesis that there is *no* association between channel position and forest section for Pacific giant salamanders in Mack Creek.

\

#### 4. Salamander weights in clear cut vs. old growth forests, 2017
In order to assess whether forest management strategies had an impact on salamander weight and abundance,  statistical testing (Student's T Test and Cohen's Effect Size) was used to compare salamander weights in clear cut and old growth forest sections in 2017.

```{r, include = FALSE}

# Create data subsets to use in two-tailed t.test
salamander_weights_cc <- salamander_clean %>% 
  filter(year == "2017", section == "CC") 

salamander_weights_og <- salamander_clean %>% 
  filter(year == "2017", section == "OG") 

ttest <- t.test(salamander_weights_cc$weight, salamander_weights_og$weight)
cohen <- cohen.d(salamander_weights_cc$weight, salamander_weights_og$weight, na.rm = TRUE)

ttest
cohen
```
In 2017, there was an `r round(abs(ttest$estimate[1]-ttest$estimate[2])/((ttest$estimate[1]+ttest$estimate[2])/2)*100,0)`% difference between salamander weights at clear-cut forest (m = `r round(ttest$estimate[1], 2)` grams) and old-growth forest (m = `r round(ttest$estimate[2], 2)` grams) sections. This difference is *not* statistically significant (t(`r round(ttest$parameter, 2)`) = `r round(ttest$statistic, 2)`, *p* = `r round(ttest$p.value, 3)`), with a negligible effect size (`r round(cohen$estimate, 2)`).

\

#### 5. Comparison of salamander weights by channel classification

```{r, fig.align="center", out.width="100%"}
# Create data subset, salamander weight in 2017
salamander_weight_2017 <- salamander_clean %>% 
  filter(year == "2017", unittype !="IP") %>% 
  select(weight, unittype) %>% 
  mutate(channel_class = 
           ifelse(unittype == "P", "Pool",
          ifelse(unittype == "SC", "Side-Channel",
          ifelse(unittype == "C", "Cascades", ""))))

# Create summary table to report means and std dev on salamander weight
salamander_wt_2017_sum <- salamander_weight_2017 %>% 
  na.omit() %>% 
  group_by(channel_class) %>% 
  summarise(sal_mean = mean(weight),
            sal_sd = sd(weight),
            sal_sd_high = sal_mean + sal_sd,
            sal_sd_low = sal_mean - sal_sd)

# Create a plot depicting salamander weights by channel classification
graph_2b <- ggplot() +
  geom_histogram(data = salamander_weight_2017, 
                aes(x = weight, 
                    fill = channel_class,
                    alpha = 0.75)) +
  scale_fill_manual(values = site_colors) +
  geom_vline(data = salamander_wt_2017_sum, 
            aes(xintercept = sal_mean,
                group = channel_class,
                color = channel_class),
            size = 1.06,
            linetype = "dotted") +
 geom_errorbarh(data = salamander_wt_2017_sum, 
               aes(y = 75, 
                   xmin = sal_sd_low,
                   xmax = sal_sd_high,
                   color = channel_class),
               width = 0.1) +
  labs(x = "Salamander weight (grams)",
       y = "Number of salamanders observed") +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0,90),
                     breaks = seq(0,90, by = 20)) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,125),
                     breaks = seq (0,125, by = 25)) +  
  scale_color_manual(values = site_colors) +
  theme_minimal() +
  facet_wrap(~channel_class) + 
  theme(legend.position = "none",
        panel.spacing = unit(1.5, "lines"))

graph_2b

graph_2d <- ggplot() +
geom_jitter(data = salamander_weight_2017, 
              aes(y = weight,
                  x = channel_class))

graph_2d


```


```{r}

# One-way ANOVA to explore possible differences in mean weights between salamanders in different parts of the channel

# First create table of summary statistics
salamander_weight_summary <- salamander_weight_2017 %>% 
  group_by(channel_class) %>% 
  summarize(
    "Mean weight (g)" = round(mean(weight, na.rm = TRUE), 2),
    "Median weight (g)" = round(median(weight, na.rm = TRUE), 2),
    "Standard deviation" = round(sd(weight, na.rm = TRUE), 2),
    "Sample size" = n(),
    "Standard error" = round(sd(weight, na.rm = TRUE) / sqrt(n()),2),
    "Variance" = round(var(weight, na.rm = TRUE),2)
  ) %>% 
  rename("Channel position" = channel_class)
  
kable(salamander_weight_summary) %>%
 kable_styling(bootstrap_options = c("striped", "hover"), 
              full_width = F,
              position = "center"
              )
```

```{r, include = FALSE}
# Levene's test 

leveneTest(weight ~ unittype, data = salamander_weight_2017)

salamander_aov <- aov(weight ~ channel_class, data = salamander_weight_2017)
summary(salamander_aov)

summary(salamander_aov)

aov_outputs <- unlist(summary(salamander_aov))
aov_outputs

# Post-hoc test run on salamander ANOVA results

salamander_post_hoc <- TukeyHSD(salamander_aov)
salamander_post_hoc

```
Mean weight (g) differed significantly between salamanders found in (one-way ANOVA with post-hoc Tukey's HSD, (F(`r aov_outputs[1]`, `r aov_outputs[2]`) = `r round(aov_outputs[7],2)`, *p* = `r round(aov_outputs[9],3)`). 

An analysis of variance (ANOVA) on salamander weights in Mack Creek  yielded significant variation among channel positions, (F(`r aov_outputs[1]`, `r aov_outputs[2]`) = `r round(aov_outputs[7],2)`, *p* = `r round(aov_outputs[9],3)`). A post hoc Tukey test showed that mean weights for salamanders found in side-channels and pools differed significantly *p* = `r round(salamander_post_hoc$channel_class[12],3)`), while we do not see siginificant differences elsewhere.

<p style="color:red">  **Next will add why means are bad! Outliers!** </p>
\

### Summary

- Based on a number of statistical tests, we do not see significant differences in Pacific giant salamander weight between different sections of forest (old growth or clear cut), or different sections of the channel (cascades, side-pool, pool).
- We also do not see significants differences between *where* in Mack Creek (cascades, pool, side-channel) salamanders are found in an old growth section of the forest versus in a clear cut section. Proportions of salamanders in the three channel classifications are similar across the two forest sections.
- These findings may suggest that Pacific giant salamanders are resilient to perturbation. ADD SOMETHING HERE ABOUT ABLE TO RECOVER OVER TIME. 
- <p style="color:red">**Maybe add something about weights not being different, not really sure why any of these results are particularly interesting? Besides above?**</p>
\

### References
**Andrews Experimental Forest. 2017.** [Location Name: Andrews Mack Creek Watershed.](http://andlter.forestry.oregonstate.edu/data/place.aspx?domain=place&dbcode=HF004&placeid=669) HJ Andrews Experimental Forest Long-Term Ecological Research.

**California Herps. 2019.** [Coastal Giant Salamander - *Dicamptodon tenebrosus*.](http://www.californiaherps.com/salamanders/pages/d.tenebrosus.html)

**Gregory S. V. 2016.** [Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present.](https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702) Environmental Data Initiative.  Dataset accessed 11/19/2019.

**Oregon Wild. 2019.** [Pacific Giant Salamander.](https://oregonwild.org/wildlife/pacific-giant-salamander)

